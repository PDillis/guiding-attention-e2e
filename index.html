<!DOCTYPE html>
<html>
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7FZPD7XRE2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7FZPD7XRE2');
  </script>

  <meta charset="utf-8">
  <!-- Meta tags for social media banners, these should be filled in appropriatly as they are your "business card" -->
  <!-- Replace the content tag with appropriate information -->
  <meta name="description" content="Guiding Attention in End-to-End Driving Models">
  <meta property="og:title" content="Guiding Attention in End-to-End Driving Models"/>
  <meta property="og:description" content="Project page for the paper 'Guiding Attention in End-to-End Driving models'"/>
  <meta property="og:url" content="https://blog.diegoporres.com/guiding-attention-e2e/"/>
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X630-->
  <meta property="og:image" content="static/images/guidingatt_banner.jpg" />
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>


  <meta name="twitter:site" content="@PDillis">
  <meta name="twitter:title" content="Diego Porres">
  <meta name="twitter:description" content="Project page for the paper 'Guiding Attention in End-to-End Driving models'">
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X600-->
  <meta name="twitter:image" content="static/images/guidingatt_banner.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <!-- Keywords for your paper to be indexed by-->
  <meta name="keywords" content="autonomous driving, end-to-end driving, attention, transformer, diego, porres, intelligent vehicles">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <title>Guiding Attention in End-to-End Driving Models</title>
  <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
  rel="stylesheet">

  <link rel="stylesheet" href="static/css/bulma.min.css">
  <link rel="stylesheet" href="static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="static/css/index.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>
  <script defer src="static/js/fontawesome.all.min.js"></script>
  <script src="static/js/bulma-carousel.min.js"></script>
  <script src="static/js/bulma-slider.min.js"></script>
  <script src="static/js/index.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>


  <section class="hero">
    <div class="hero-body">
      <div class="container is-max-desktop">
        <div class="columns is-centered">
          <div class="column has-text-centered">
            <h1 class="title is-1 publication-title">Guiding Attention in End-to-End Driving Models</h1>
            <div class="is-size-5 publication-authors">
              <!-- Paper authors -->
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=Xuv3WuIAAAAJ&hl=en&authuser=1" target="_blank">Diego Porres</a>,</span>
                <span class="author-block">
                  <a href="https://scholar.google.com/citations?hl=en&authuser=1&user=_2mQDJEAAAAJ" target="_blank">Yi Xiao</a>,</span>
                  <span class="author-block">
                    <a href="https://scholar.google.com/citations?hl=en&authuser=1&user=byJeaV0AAAAJ" target="_blank">Gabriel Villalonga</a>,</span>
                    <span class="author-block">
                      <a href="https://scholar.google.com/citations?view_op=list_works&hl=en&user=Um9rfMwAAAAJ" target="_blank">Alexandre Levy</a>,</span>
                      <span class="author-block">
                        <a href="https://scholar.google.com/citations?hl=en&authuser=1&user=3LYW1zMAAAAJ" target="_blank">Antonio M. LÃ³pez</a></span>
                    </span>
                  </div>

                  
                  <div class="column has-text-centered">
                    <div class="is-size-5 publication-authors">
                      <span class="author-block">Computer Vision Center<br>Intelligent Vehicles Symposium (IV) 2024</span>
                    </div>
                    <div class="publication-links">
                         <!-- Arxiv PDF link -->
                      <span class="link-block">
                        <a href="https://arxiv.org/pdf/2405.00242" target="_blank"
                        class="external-link button is-normal is-rounded is-dark">
                        <span class="icon">
                          <i class="fas fa-file-pdf"></i>
                        </span>
                        <span>Paper</span>
                      </a>
                    </span>

                  <!-- Github link -->
                  <span class="link-block">
                    <a href="https://github.com/PDillis/guiding-attention-e2e" target="_blank"
                    class="external-link button is-normal is-rounded is-dark">
                    <span class="icon">
                      <i class="fab fa-github"></i>
                    </span>
                    <span>Code (soon!)</span>
                  </a>
                </span>

                <!-- ArXiv abstract Link -->
                <span class="link-block">
                  <a href="https://arxiv.org/abs/2405.00242" target="_blank"
                  class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- Teaser video-->
<section class="hero teaser" id="teaser">
  <div class="container is-max-desktop">
    <div class="hero-body">
      <video poster="" id="tree" autoplay controls muted loop width="100%">
        <!-- Your video here -->
        <source src="static/videos/cilplusplus_attloss_town05_route05_softrainsunset_55hdata_faster.mp4"
        type="video/mp4">
      </video>
      <h2 class="subtitle has-text-justified">
        By <strong>optimizing the attention weights</strong> of a pure vision-based end-to-end driving model, we are able to increase the model's interpretability and enhance its driving capabilities with the available data, at <em>no additional compute cost</em> during testing time. Model trained with 55 hours of driving data in multiple towns in CARLA, and evaluated in the unseen <code>Town05</code> under new weather conditions.
      </h2>
    </div>
  </div>
</section>
<!-- End teaser video -->

<!-- Paper abstract -->
<section class="section hero is-light" id="abstract">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Vision-based end-to-end driving models trained by imitation learning can lead to affordable solutions for autonomous driving. However, training these well-performing models usually requires a huge amount of data, while still lacking explicit and intuitive activation maps to reveal the inner workings of these models while driving. In this paper, we study how to guide the attention of these models to improve their driving quality and obtain more intuitive activation maps by adding a loss term during training using salient semantic maps. In contrast to previous work, <strong>our method does not require these salient semantic maps to be available during testing time</strong>, as well as removing the need to modify the model's architecture to which it is applied. We perform tests using perfect and noisy salient semantic maps with encouraging results in both, the latter of which is inspired by possible errors encountered with real data. Using CIL++ as a representative state-of-the-art model and the CARLA simulator with its standard benchmarks, we conduct experiments that show the effectiveness of our method in training better autonomous driving models, especially when data and computational resources are scarce.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End paper abstract -->


<section class="hero-is-small" id="introduction">
  <div class="container">
    <div class="hero-body">
      <h2 class="title is-3">Introduction</h2>
      <div class="content has-text-justified">
      <p>Vision activation maps of end-to-end driving models are usually non-human readable, even if the model manages to drive perfectly in the environment it is deployed in. We seek, then, to train these activation maps with a ground-truth <em>synthetic attention mask</em> (whether human or based from sensor readings),and analyze their effects on the driving performance of a pure-vision based end-to-end driving model CIL++. We do so with our proposed <strong>Attention Loss</strong>, with the added benefit of keeping the original architecture.</p>
    </div>
      <div class="item">
        <img src="static/images/ArchAttLoss_v2_tiny.png" alt="" class="center" width="100%"/> </div>
  </div>
</section>

<section class="hero is-small" id="results">
  <div class="container">
    <div class="hero-body">
      <h2 class="title is-3">Results</h2>
      <h2 class="title is-5">What happens if we have a low amount of training data?</h2>
      <div class="content has-text-justified">
      <p>When dealing with a low amount of training data (below 8 hours in total), we can further subdivide this into two categories: low amount and low diversity. For the former, we train the CIL++ model with and without the Attention Loss while decreasing the amount of training data (akin to lowering the FPS at which the data was collected).</p>
    </div>
      <div class="item">
        <img src="static/images/LowDataPlots_DrivingHours.png" alt="" class="center"/>
      </div>
      <div class="content has-text-justified">
      <p>For the low diversity experiments, we start with one weather type in the data and slowly add the rest, one by one. Each weather type contains approximately 2 hours of data, so that the original 8 hours of data will contain the four weather types: <code>ClearNoon</code> (CN), <code>ClearSunset</code> (CS), <code>HardRainNoon</code> (HRN), and <code>WetNoon</code> (WN).</p>
    </div>
      <div class="item">
        <img src="static/images/LowDataPlots_Weathers.png" alt="" class="center"/>
    </div>
    <div class="content has-text-justified">
    <p>We can see that the results are consistent: adding the Attention Loss during training boosts performance of the model by up to 4 times, requiring less data to be stored and trained with. For both, the training data was collected in <code>Town01</code> and models were evaluated in <code>Town02</code> in CARLA, using new weather conditions.</p>
    </div>
  </div>
</section>

<section class="hero is-small" id="noisy-masks">
  <div class="container">
    <div class="hero-body">
      <h2 class="title is-5">How will the model perform with noisy masks?</h2>
      <div class="content has-text-justified">
      <p>When we collect data in the real world, we won't have perfect <em>synthetic attention masks</em> \(\mathcal{M}\). They will typically be noisy, usually by error accumulation of the models we use to predict the semantic segmentation, depth, or both. To mimic these noisy masks, we define a function \( f \) that will add Perlin noise to the masks and other granular noise to larger objects. Additionally, we train a U-Net to obtain \( \widehat{\mathcal{M}} \), the predicted mask given an input image. We show some examples in the following figure:</p>
    </div>
      <div class="item">
        <img src="static/images/masks_predictions_corruptions.png" alt="" class="center"/>
      </div>
      <div class="content has-text-justified">
      <p>
        Typically, the <em>synthetic attention masks</em> are used as input in different ways. Soft Mask (SM) appends the mask as a fourth channel to the input RGB image. Hard Mask (HM) does an element-wise multiplication with the RGB channels, effectively removing "unnecessary" data. When predicting the masks, we must do so during training and testing time, increasing the required compute. For comparison, we train a model with noisy masks using the Attention Loss, but note that for our case, we do not need to predict these during validation. In the following table, we train all models using 14 hours of driving data in <code>Town01</code> and validate the driving in <code>Town02</code>. Our proposed loss obtains the best driving results without the need to remove parts of the input.</p>
    </div>
      <div class="item">
        <img src="static/images/table_highdata_sl.png" alt="" class="center"/>
      </div>
      <div class="content has-text-justified">
      <p>To test the high-data regime in more complex scenarios, we collect 55 hours of driving data in multiple towns in CARLA: <code>Town01</code>, <code>Town02</code>, <code>Town03</code>, <code>Town04</code>, and <code>Town06</code>, and test in the unseen <code>Town05</code> under new weather conditions. We note a particular boost in the Driving Score and Infraction Score, resulting from a better adherence to the traffic rules from the model.</p>
    </div>
      <div class="item">
        <img src="static/images/table_highdata_ml.png" alt="" class="center"/>
    </div>
  </div>
</section>

<!-- Video carousel -->
<section class="hero is-small" id="visualizations">
  <div class="container">
    <div class="hero-body">
      <div class="container">
        <h2 class="title is-3">Additional Visualizations</h2>
        <div class="content has-text-justified">
        <p>For the following, we show the attention maps of the last layer of the Transformer Encoder for models trained with 14 hours of data collected in <code>Town01</code>. We perform the evaluation in <code>Town02</code> under new weather conditions.</p>
      </div>
        <div id="results-carousel" class="carousel results-carousel">
          <div class="item item-video1">
            <video poster="" id="video1" autoplay controls muted loop width="100%">
              <!-- Your video file here -->
              <source src="static/videos/cilplusplus_attention_town02_route16_softrainsunset_14hdata_faster.mp4"
              type="video/mp4">
            </video>
            <h2 class="subtitle has-text-justified">
              CIL++ trained <strong>with Attention Loss</strong>. New weather: <code>SoftRainSunset</code>
            </h2>
          </div>
          <div class="item item-video2">
            <video poster="" id="video2" autoplay controls muted loop width="100%">
              <!-- Your video file here -->
              <source src="static/videos/cilplusplus_noattention_town02_route16_softrainsunset_14hdata_faster.mp4"
              type="video/mp4">
            </video>
            <h2 class="subtitle has-text-justified">
              CIL++ trained <strong><em>without</em> Attention Loss</strong>. New weather: <code>SoftRainSunset</code>
            </h2>
          </div>
          <div class="item item-video3">
            <video poster="" id="video3" autoplay controls muted loop width="100%">\
              <!-- Your video file here -->
              <source src="static/videos/cilplusplus_attention_town02_route24_clearnight_14hdata_faster.mp4"
              type="video/mp4">
            </video>
            <h2 class="subtitle has-text-justified">
              CIL++ trained <strong>with Attention Loss</strong>. New weather: <code>ClearNight</code>
            </h2>
          </div>
          <div class="item item-video4">
            <video poster="" id="video4" autoplay controls muted loop width="100%">\
              <!-- Your video file here -->
              <source src="static/videos/cilplusplus_noattention_town02_route24_clearnight_14hdata_faster.mp4"
              type="video/mp4">
            </video>
            <h2 class="subtitle has-text-justified">
              CIL++ trained <strong><em>without</em> Attention Loss</strong>. New weather: <code>ClearNight</code>
            </h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End video carousel -->


<!-- Paper poster -->
<section class="hero is-small is-light" id="poster">
  <div class="container">
    <div class="hero-body">
      <div class="container">
        <h2 class="title">Poster</h2>

        <iframe  src="static/pdfs/IEEEIV2024_GuidingAttentionPoster.pdf" width="100%" height="550">
            </iframe>
          
        </div>
      </div>
    </div>
  </section>
<!--End paper poster -->


<!--BibTex citation -->
  <section class="section" id="BibTeX" id="bibtex">
    <div class="container is-max-desktop content">
      <h2 class="title">BibTeX</h2>
      <pre>
        <code class="language-bibtex" data-lang="bibtex">
@misc{porres2024guiding,
  title={Guiding Attention in End-to-End Driving Models}, 
  author={Diego Porres and Yi Xiao and Gabriel Villalonga and Alexandre Levy and Antonio M. LÃ³pez},
  year={2024},
  eprint={2405.00242},
  archivePrefix={arXiv},
  primaryClass={cs.CV}
}
      </code></pre>
    </div>
</section>
<!--End BibTex citation -->

<!--Acknowledgements-->
<section class="section" id="acknowledgements">
  <div class="container is-max-desktop content">
    <h2 class="title">Acknowledgements</h2>
    <div class="content">
      <p>
        This research is supported by project TED2021-132802BI00 funded by MCIN/AEI/10.13039/501100011033 and the European Union NextGenerationEU/PRTR. Antonio M. Lopez acknowledges the financial support to his general research activities given by ICREA under the ICREA Academia Program. Antonio and Gabriel thank the synergies, in terms of research ideas, arising from the project PID2020-115734RB-C21 funded by MCIN/AEI/10.13039/501100011033. The authors acknowledge the support of the Generalitat de Catalunya CERCA Program and its ACCIO agency to CVCâs general activities.
      </p>
    </div>

    <div class="item">
      <img src="static/images/logos_inst_whitebg.png" alt="Institutioinal logos." class="center"/>
    </div>
  </div>
</section>


<!--End Acknowledgements-->

  <footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">

          <p>
            This page was built using the <a href="https://github.com/eliahuhorwitz/Academic-project-page-template" target="_blank">Academic Project Page Template</a> which was adopted from theÂ <a href="https://nerfies.github.io" target="_blank">Nerfies</a>Â project page.
            You are free to borrow the of this website, we just ask that you link back to this page in the footer. <br> This website is licensed under a <a rel="license"  href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>

        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Statcounter tracking code -->
  
<!-- You can add a tracker to track page visits by creating an account at statcounter.com -->

    <!-- End of Statcounter Code -->

  </body>
  </html>
